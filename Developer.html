
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>白名单管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .container {
            margin-top: 2rem;
        }
        .card {
            margin-bottom: 2rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        .table-responsive {
            margin-top: 1rem;
        }
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        .modal-footer {
            justify-content: space-between;
        }
        .tab-content {
            margin-top: 1rem;
        }
        .nav-tabs {
            margin-bottom: 1rem;
        }
    </style>
</head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="index.html">Kosto管理系统</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">首页</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="whitelist-manager.html">白名单管理</a>
                        </li>
                    </ul>
                    <div class="d-flex align-items-center">
                        <div class="input-group me-2" style="width: 250px;">
                            <input type="password" id="githubToken" class="form-control form-control-sm" placeholder="GitHub Token">
                            <button class="btn btn-outline-light btn-sm" type="button" id="saveTokenBtn">保存Token</button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 权限提示 -->
        <div id="permissionError" class="container mt-4" style="display: none;">
            <div class="alert alert-danger">
                <h2>权限不足</h2>
                <p>您的GitHub Token没有编辑1.json的权限，请输入有效的Token。</p>
            </div>
        </div>

        <!-- 登录模态窗口 -->
        <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="loginModalLabel">请登录</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="关闭"></button>
                    </div>
                    <div class="modal-body">
                        <p>请输入您的GitHub Token以访问白名单管理系统。</p>
                        <div class="input-group mb-3">
                            <input type="password" id="githubTokenModal" class="form-control" placeholder="GitHub Token">
                        </div>
                        <div class="alert alert-danger" id="invalidTokenAlert" style="display: none;">
                            <p>Token无效或无权限访问文件，请重新输入。</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="confirmLoginBtn">确认登录</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <h1 class="mb-4">白名单管理系统</h1>

            <!-- 搜索功能 -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="input-group">
                                <input type="text" id="searchInput" class="form-control" placeholder="搜索...">
                                <button class="btn btn-primary" id="searchBtn"><i class="fas fa-search"></i> 搜索</button>
                                <button class="btn btn-outline-secondary" id="clearSearchBtn"><i class="fas fa-times"></i> 清除</button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="searchType" id="searchGroups" value="groups" checked>
                                <label class="form-check-label" for="searchGroups">军团</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="searchType" id="searchUsers" value="users">
                                <label class="form-check-label" for="searchUsers">用户</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="searchType" id="searchTanknames" value="tanknames">
                                <label class="form-check-label" for="searchTanknames">白名单ID</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="searchType" id="searchOurs" value="ours">
                                <label class="form-check-label" for="searchOurs">开发者</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="searchType" id="searchSs" value="ss">
                                <label class="form-check-label" for="searchSs">自爆标志</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="searchType" id="searchCookie1" value="cookie1">
                                <label class="form-check-label" for="searchCookie1">身份验证</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 标签页导航 -->
            <ul class="nav nav-tabs" id="whitelistTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="tanknames-tab" data-bs-toggle="tab" data-bs-target="#tanknames" type="button" role="tab" aria-controls="tanknames" aria-selected="true"><i class="fas fa-id-card"></i> 白名单用户ID</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="groups-tab" data-bs-toggle="tab" data-bs-target="#groups" type="button" role="tab" aria-controls="groups" aria-selected="false"><i class="fas fa-users"></i> 白名单军团</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="ours-tab" data-bs-toggle="tab" data-bs-target="#ours" type="button" role="tab" aria-controls="ours" aria-selected="false"><i class="fas fa-crown"></i> 开发者ID</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="ss-tab" data-bs-toggle="tab" data-bs-target="#ss" type="button" role="tab" aria-controls="ss" aria-selected="false"><i class="fas fa-bomb"></i> 自爆程序标志</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="cookie1-tab" data-bs-toggle="tab" data-bs-target="#cookie1" type="button" role="tab" aria-controls="cookie1" aria-selected="false"><i class="fas fa-key"></i> 身份验证Cookie</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab" aria-controls="users" aria-selected="false"><i class="fas fa-user"></i> 用户指纹数据</button>
                </li>
            </ul>

            <!-- 标签页内容 -->
            <div class="tab-content" id="whitelistTabsContent">
                <!-- 白名单用户ID -->
                <div class="tab-pane fade show active" id="tanknames" role="tabpanel" aria-labelledby="tanknames-tab">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">白名单用户ID (tankname)</h5>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTanknameModal">
                                <i class="fas fa-plus"></i> 添加ID
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>用户ID</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tanknamesTableBody">
                                        <!-- 数据将通过JS动态加载 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 白名单军团 -->
                <div class="tab-pane fade" id="groups" role="tabpanel" aria-labelledby="groups-tab">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">白名单军团 (clanname)</h5>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addGroupModal">
                                <i class="fas fa-plus"></i> 添加组
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>军团名称</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="groupsTableBody">
                                        <!-- 组数据将通过JS动态加载 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 开发者ID -->
                <div class="tab-pane fade" id="ours" role="tabpanel" aria-labelledby="ours-tab">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">开发者ID (ours)</h5>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addOurModal">
                                <i class="fas fa-plus"></i> 添加开发者
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>开发者ID</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="oursTableBody">
                                        <!-- 数据将通过JS动态加载 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 自爆程序标志 -->
                <div class="tab-pane fade" id="ss" role="tabpanel" aria-labelledby="ss-tab">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">自爆程序标志 (ss)</h5>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSsModal">
                                <i class="fas fa-plus"></i> 添加标志
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>标志值</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ssTableBody">
                                        <!-- 数据将通过JS动态加载 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 身份验证Cookie -->
                <div class="tab-pane fade" id="cookie1" role="tabpanel" aria-labelledby="cookie1-tab">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">身份验证Cookie (cookie1)</h5>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCookie1Modal">
                                <i class="fas fa-plus"></i> 添加Cookie
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Cookie值</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cookie1TableBody">
                                        <!-- 数据将通过JS动态加载 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 用户指纹数据 -->
                <div class="tab-pane fade" id="users" role="tabpanel" aria-labelledby="users-tab">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">用户指纹数据 (cookie3)</h5>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                                <i class="fas fa-plus"></i> 添加用户
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>名称</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersTableBody">
                                        <!-- 用户数据将通过JS动态加载 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 保存按钮 -->
            <div class="d-flex justify-content-center mt-4">
                <button id="saveChangesBtn" class="btn btn-success btn-lg">保存更改</button>
            </div>
        </div>

        <!-- 添加组模态框 -->
        <div class="modal fade" id="addGroupModal" tabindex="-1" aria-labelledby="addGroupModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addGroupModalLabel">添加白名单军团</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="groupName" class="form-label">组名称</label>
                            <input type="text" class="form-control" id="groupName" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="confirmAddGroup">添加</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 编辑组模态框 -->
        <div class="modal fade" id="editGroupModal" tabindex="-1" aria-labelledby="editGroupModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editGroupModalLabel">编辑白名单军团</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="editGroupName" class="form-label">军团名称</label>
                            <input type="text" class="form-control" id="editGroupName" required>
                            <input type="hidden" id="editGroupIndex">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="confirmEditGroup">保存</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 添加用户模态框 -->
        <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addUserModalLabel">添加VIP用户</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="userId" class="form-label">VIP用户浏览器ID</label>
                            <input type="text" class="form-control" id="userId" required>
                        </div>
                        <div class="mb-3">
                            <label for="userName" class="form-label">ID</label>
                            <input type="text" class="form-control" id="userName" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="confirmAddUser">添加</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 编辑用户模态框 -->
        <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editUserModalLabel">编辑用户</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="editUserId" class="form-label">用户ID</label>
                            <input type="text" class="form-control" id="editUserId" required>
                        </div>
                        <div class="mb-3">
                            <label for="editUserName" class="form-label">用户名称</label>
                            <input type="text" class="form-control" id="editUserName" required>
                            <input type="hidden" id="editUserIndex">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="confirmEditUser">保存</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 添加白名单用户ID模态框 -->
        <div class="modal fade" id="addTanknameModal" tabindex="-1" aria-labelledby="addTanknameModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addTanknameModalLabel">添加白名单用户ID</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="tanknameId" class="form-label">用户ID</label>
                            <input type="text" class="form-control" id="tanknameId" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="confirmAddTankname">添加</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 编辑白名单用户ID模态框 -->
        <div class="modal fade" id="editTanknameModal" tabindex="-1" aria-labelledby="editTanknameModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editTanknameModalLabel">编辑白名单用户ID</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="editTanknameId" class="form-label">用户ID</label>
                            <input type="text" class="form-control" id="editTanknameId" required>
                            <input type="hidden" id="editTanknameIndex">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="confirmEditTankname">保存</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 添加开发者ID模态框 -->
        <div class="modal fade" id="addOurModal" tabindex="-1" aria-labelledby="addOurModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addOurModalLabel">添加开发者ID</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="ourId" class="form-label">开发者ID</label>
                            <input type="text" class="form-control" id="ourId" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="confirmAddOur">添加</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 编辑开发者ID模态框 -->
        <div class="modal fade" id="editOurModal" tabindex="-1" aria-labelledby="editOurModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editOurModalLabel">编辑开发者ID</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="editOurId" class="form-label">开发者ID</label>
                            <input type="text" class="form-control" id="editOurId" required>
                            <input type="hidden" id="editOurIndex">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="confirmEditOur">保存</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 添加自爆程序标志模态框 -->
        <div class="modal fade" id="addSsModal" tabindex="-1" aria-labelledby="addSsModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addSsModalLabel">添加自爆程序标志</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="ssValue" class="form-label">标志值</label>
                            <input type="text" class="form-control" id="ssValue" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="confirmAddSs">添加</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 编辑自爆程序标志模态框 -->
        <div class="modal fade" id="editSsModal" tabindex="-1" aria-labelledby="editSsModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editSsModalLabel">编辑自爆程序标志</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="editSsValue" class="form-label">标志值</label>
                            <input type="text" class="form-control" id="editSsValue" required>
                            <input type="hidden" id="editSsIndex">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="confirmEditSs">保存</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 添加身份验证Cookie模态框 -->
        <div class="modal fade" id="addCookie1Modal" tabindex="-1" aria-labelledby="addCookie1ModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addCookie1ModalLabel">添加身份验证Cookie</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="cookie1Value" class="form-label">Cookie值</label>
                            <input type="text" class="form-control" id="cookie1Value" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="confirmAddCookie1">添加</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 编辑身份验证Cookie模态框 -->
        <div class="modal fade" id="editCookie1Modal" tabindex="-1" aria-labelledby="editCookie1ModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editCookie1ModalLabel">编辑身份验证Cookie</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="editCookie1Value" class="form-label">Cookie值</label>
                            <input type="text" class="form-control" id="editCookie1Value" required>
                            <input type="hidden" id="editCookie1Index">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="confirmEditCookie1">保存</button>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            // 存储白名单数据
            let whitelistData = [];
            const TANKNAMES_INDEX = 0; // 白名单用户ID在JSON中的索引
            const GROUPS_INDEX = 1;   // 组数据在JSON中的索引
            const OURS_INDEX = 2;     // 开发者ID在JSON中的索引
            const SS_INDEX = 3;       // 自爆程序标志在JSON中的索引
            const COOKIE1_INDEX = 4;  // 身份验证Cookie在JSON中的索引
            const USERS_INDEX = 5;    // 用户数据在JSON中的索引

            // DOM元素
            const tanknamesTableBody = document.getElementById('tanknamesTableBody');
            const groupsTableBody = document.getElementById('groupsTableBody');
            const oursTableBody = document.getElementById('oursTableBody');
            const ssTableBody = document.getElementById('ssTableBody');
            const cookie1TableBody = document.getElementById('cookie1TableBody');
            const usersTableBody = document.getElementById('usersTableBody');
            const saveChangesBtn = document.getElementById('saveChangesBtn');
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            const clearSearchBtn = document.getElementById('clearSearchBtn');
            const searchTanknamesRadio = document.getElementById('searchTanknames');
            const searchGroupsRadio = document.getElementById('searchGroups');
            const searchOursRadio = document.getElementById('searchOurs');
            const searchSsRadio = document.getElementById('searchSs');
            const searchCookie1Radio = document.getElementById('searchCookie1');
            const searchUsersRadio = document.getElementById('searchUsers');

            // 存储原始数据，用于搜索恢复
            let originalTanknames = [];
            let originalGroups = [];
            let originalOurs = [];
            let originalSs = [];
            let originalCookie1 = [];
            let originalUsers = [];

            // 初始化
            async function init() {
                try {
                    // 从GitHub获取白名单数据
                    const response = await fetch('https://raw.githubusercontent.com/Kosto179cn/Kosto.github.io/main/js/1/1.json');
                    whitelistData = await response.json();
                    
                    // 初始化空数组（如果不存在）
                    if (!Array.isArray(whitelistData[TANKNAMES_INDEX])) whitelistData[TANKNAMES_INDEX] = [];
                    if (!Array.isArray(whitelistData[GROUPS_INDEX])) whitelistData[GROUPS_INDEX] = [];
                    if (!Array.isArray(whitelistData[OURS_INDEX])) whitelistData[OURS_INDEX] = [];
                    if (!Array.isArray(whitelistData[SS_INDEX])) whitelistData[SS_INDEX] = [];
                    if (!Array.isArray(whitelistData[COOKIE1_INDEX])) whitelistData[COOKIE1_INDEX] = [];
                    if (!Array.isArray(whitelistData[USERS_INDEX])) whitelistData[USERS_INDEX] = [];
                    
                    // 保存原始数据副本
                    originalTanknames = [...whitelistData[TANKNAMES_INDEX]];
                    originalGroups = [...whitelistData[GROUPS_INDEX]];
                    originalOurs = [...whitelistData[OURS_INDEX]];
                    originalSs = [...whitelistData[SS_INDEX]];
                    originalCookie1 = [...whitelistData[COOKIE1_INDEX]];
                    originalUsers = [...whitelistData[USERS_INDEX]];
                    
                    renderTanknamesTable();
                    renderGroupsTable();
                    renderOursTable();
                    renderSsTable();
                    renderCookie1Table();
                    renderUsersTable();
                } catch (error) {
                    console.error('加载白名单数据失败:', error);
                    alert('加载白名单数据失败，请刷新页面重试。');
                }
            }

            /**
             * 处理搜索
             */
            function handleSearch() {
                const searchTerm = searchInput.value.toLowerCase().trim();
                let searchType;
                
                if (searchTanknamesRadio.checked) searchType = 'tanknames';
                else if (searchGroupsRadio.checked) searchType = 'groups';
                else if (searchOursRadio.checked) searchType = 'ours';
                else if (searchSsRadio.checked) searchType = 'ss';
                else if (searchCookie1Radio.checked) searchType = 'cookie1';
                else searchType = 'users';

                switch (searchType) {
                    case 'tanknames':
                        // 搜索白名单用户ID
                        const filteredTanknames = originalTanknames.filter(id => 
                            id.toLowerCase().includes(searchTerm)
                        );
                        whitelistData[TANKNAMES_INDEX] = filteredTanknames;
                        renderTanknamesTable();
                        break;
                    case 'groups':
                        // 搜索组
                        const filteredGroups = originalGroups.filter(group => 
                            group.toLowerCase().includes(searchTerm)
                        );
                        whitelistData[GROUPS_INDEX] = filteredGroups;
                        renderGroupsTable();
                        break;
                    case 'ours':
                        // 搜索开发者ID
                        const filteredOurs = originalOurs.filter(id => 
                            id.toLowerCase().includes(searchTerm)
                        );
                        whitelistData[OURS_INDEX] = filteredOurs;
                        renderOursTable();
                        break;
                    case 'ss':
                        // 搜索自爆程序标志
                        const filteredSs = originalSs.filter(ss => 
                            ss.toLowerCase().includes(searchTerm)
                        );
                        whitelistData[SS_INDEX] = filteredSs;
                        renderSsTable();
                        break;
                    case 'cookie1':
                        // 搜索身份验证Cookie
                        const filteredCookie1 = originalCookie1.filter(cookie => 
                            cookie.toLowerCase().includes(searchTerm)
                        );
                        whitelistData[COOKIE1_INDEX] = filteredCookie1;
                        renderCookie1Table();
                        break;
                    case 'users':
                    default:
                        // 搜索用户
                        const filteredUsers = originalUsers.filter(user => 
                            (user['id:'] || '').toLowerCase().includes(searchTerm) || 
                            (user['name:'] || '').toLowerCase().includes(searchTerm)
                        );
                        whitelistData[USERS_INDEX] = filteredUsers;
                        renderUsersTable();
                        break;
                }
            }

            /**
             * 清除搜索
             */
            function clearSearch() {
                searchInput.value = '';
                whitelistData[TANKNAMES_INDEX] = [...originalTanknames];
                whitelistData[GROUPS_INDEX] = [...originalGroups];
                whitelistData[OURS_INDEX] = [...originalOurs];
                whitelistData[SS_INDEX] = [...originalSs];
                whitelistData[COOKIE1_INDEX] = [...originalCookie1];
                whitelistData[USERS_INDEX] = [...originalUsers];
                renderTanknamesTable();
                renderGroupsTable();
                renderOursTable();
                renderSsTable();
                renderCookie1Table();
                renderUsersTable();
            }

            // 添加搜索和清除事件监听
            searchBtn.addEventListener('click', handleSearch);
            clearSearchBtn.addEventListener('click', clearSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleSearch();
                }
            });
            searchTanknamesRadio.addEventListener('change', clearSearch);
            searchGroupsRadio.addEventListener('change', clearSearch);
            searchOursRadio.addEventListener('change', clearSearch);
            searchSsRadio.addEventListener('change', clearSearch);
            searchCookie1Radio.addEventListener('change', clearSearch);
            searchUsersRadio.addEventListener('change', clearSearch);

            /**
             * 渲染白名单用户ID表格
             */
            function renderTanknamesTable() {
                const tanknames = whitelistData[TANKNAMES_INDEX] || [];
                tanknamesTableBody.innerHTML = '';

                tanknames.forEach((id, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${id}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline-primary edit-tankname" data-index="${index}">编辑</button>
                            <button class="btn btn-sm btn-outline-danger delete-tankname" data-index="${index}">删除</button>
                        </td>
                    `;
                    tanknamesTableBody.appendChild(row);
                });

                // 添加编辑和删除事件监听
                document.querySelectorAll('.edit-tankname').forEach(button => {
                    button.addEventListener('click', handleEditTankname);
                });
                document.querySelectorAll('.delete-tankname').forEach(button => {
                    button.addEventListener('click', handleDeleteTankname);
                });
            }

            /**
             * 渲染白名单军团表格
             */
            function renderGroupsTable() {
                const groups = whitelistData[GROUPS_INDEX] || [];
                groupsTableBody.innerHTML = '';

                groups.forEach((group, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${group}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline-primary edit-group" data-index="${index}">编辑</button>
                            <button class="btn btn-sm btn-outline-danger delete-group" data-index="${index}">删除</button>
                        </td>
                    `;
                    groupsTableBody.appendChild(row);
                });

                // 添加编辑和删除事件监听
                document.querySelectorAll('.edit-group').forEach(button => {
                    button.addEventListener('click', handleEditGroup);
                });
                document.querySelectorAll('.delete-group').forEach(button => {
                    button.addEventListener('click', handleDeleteGroup);
                });
            }

            /**
             * 渲染开发者ID表格
             */
            function renderOursTable() {
                const ours = whitelistData[OURS_INDEX] || [];
                oursTableBody.innerHTML = '';

                ours.forEach((id, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${id}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline-primary edit-our" data-index="${index}">编辑</button>
                            <button class="btn btn-sm btn-outline-danger delete-our" data-index="${index}">删除</button>
                        </td>
                    `;
                    oursTableBody.appendChild(row);
                });

                // 添加编辑和删除事件监听
                document.querySelectorAll('.edit-our').forEach(button => {
                    button.addEventListener('click', handleEditOur);
                });
                document.querySelectorAll('.delete-our').forEach(button => {
                    button.addEventListener('click', handleDeleteOur);
                });
            }

            /**
             * 渲染自爆程序标志表格
             */
            function renderSsTable() {
                const ss = whitelistData[SS_INDEX] || [];
                ssTableBody.innerHTML = '';

                ss.forEach((value, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${value}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline-primary edit-ss" data-index="${index}">编辑</button>
                            <button class="btn btn-sm btn-outline-danger delete-ss" data-index="${index}">删除</button>
                        </td>
                    `;
                    ssTableBody.appendChild(row);
                });

                // 添加编辑和删除事件监听
                document.querySelectorAll('.edit-ss').forEach(button => {
                    button.addEventListener('click', handleEditSs);
                });
                document.querySelectorAll('.delete-ss').forEach(button => {
                    button.addEventListener('click', handleDeleteSs);
                });
            }

            /**
             * 渲染身份验证Cookie表格
             */
            function renderCookie1Table() {
                const cookie1 = whitelistData[COOKIE1_INDEX] || [];
                cookie1TableBody.innerHTML = '';

                cookie1.forEach((value, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${value}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline-primary edit-cookie1" data-index="${index}">编辑</button>
                            <button class="btn btn-sm btn-outline-danger delete-cookie1" data-index="${index}">删除</button>
                        </td>
                    `;
                    cookie1TableBody.appendChild(row);
                });

                // 添加编辑和删除事件监听
                document.querySelectorAll('.edit-cookie1').forEach(button => {
                    button.addEventListener('click', handleEditCookie1);
                });
                document.querySelectorAll('.delete-cookie1').forEach(button => {
                    button.addEventListener('click', handleDeleteCookie1);
                });
            }

            /**
             * 渲染用户白名单表格
             */
            function renderUsersTable() {
                const users = whitelistData[USERS_INDEX] || [];
                usersTableBody.innerHTML = '';

                users.forEach((user, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user['id:'] || ''}</td>
                        <td>${user['name:'] || ''}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline-primary edit-user" data-index="${index}">编辑</button>
                            <button class="btn btn-sm btn-outline-danger delete-user" data-index="${index}">删除</button>
                        </td>
                    `;
                    usersTableBody.appendChild(row);
                });

                // 添加编辑和删除事件监听
                document.querySelectorAll('.edit-user').forEach(button => {
                    button.addEventListener('click', handleEditUser);
                });
                document.querySelectorAll('.delete-user').forEach(button => {
                    button.addEventListener('click', handleDeleteUser);
                });
            }

            /**
             * 处理添加白名单用户ID
             */
            document.getElementById('confirmAddTankname').addEventListener('click', () => {
                const tanknameId = document.getElementById('tanknameId').value.trim();
                if (!tanknameId) return;

                whitelistData[TANKNAMES_INDEX].push(tanknameId);
                renderTanknamesTable();

                // 关闭模态框并重置表单
                const modal = bootstrap.Modal.getInstance(document.getElementById('addTanknameModal'));
                modal.hide();
                document.getElementById('tanknameId').value = '';
            });

            /**
             * 处理编辑白名单用户ID
             */
            function handleEditTankname(event) {
                const index = parseInt(event.target.dataset.index);
                const tanknames = whitelistData[TANKNAMES_INDEX] || [];
                const id = tanknames[index];

                document.getElementById('editTanknameId').value = id;
                document.getElementById('editTanknameIndex').value = index;
                const modal = new bootstrap.Modal(document.getElementById('editTanknameModal'));
                modal.show();
            }

            /**
             * 确认编辑白名单用户ID
             */
            document.getElementById('confirmEditTankname').addEventListener('click', () => {
                const index = parseInt(document.getElementById('editTanknameIndex').value);
                const newId = document.getElementById('editTanknameId').value.trim();
                if (!newId) return;

                whitelistData[TANKNAMES_INDEX][index] = newId;
                renderTanknamesTable();

                // 关闭模态框
                const modal = bootstrap.Modal.getInstance(document.getElementById('editTanknameModal'));
                modal.hide();
            });

            /**
             * 处理删除白名单用户ID
             */
            function handleDeleteTankname(event) {
                const index = parseInt(event.target.dataset.index);
                if (confirm('确定要删除这个用户ID吗？')) {
                    whitelistData[TANKNAMES_INDEX].splice(index, 1);
                    renderTanknamesTable();
                }
            }

            /**
             * 处理添加组
             */
            document.getElementById('confirmAddGroup').addEventListener('click', () => {
                const groupName = document.getElementById('groupName').value.trim();
                if (!groupName) return;

                whitelistData[GROUPS_INDEX].push(groupName);
                renderGroupsTable();

                // 关闭模态框并重置表单
                const modal = bootstrap.Modal.getInstance(document.getElementById('addGroupModal'));
                modal.hide();
                document.getElementById('groupName').value = '';
            });

            /**
             * 处理编辑组
             */
            function handleEditGroup(event) {
                const index = parseInt(event.target.dataset.index);
                const groups = whitelistData[GROUPS_INDEX] || [];
                const group = groups[index];

                document.getElementById('editGroupName').value = group;
                document.getElementById('editGroupIndex').value = index;
                const modal = new bootstrap.Modal(document.getElementById('editGroupModal'));
                modal.show();
            }

            /**
             * 处理添加开发者ID
             */
            document.getElementById('confirmAddOur').addEventListener('click', () => {
                const ourId = document.getElementById('ourId').value.trim();
                if (!ourId) return;

                whitelistData[OURS_INDEX].push(ourId);
                renderOursTable();

                // 关闭模态框并重置表单
                const modal = bootstrap.Modal.getInstance(document.getElementById('addOurModal'));
                modal.hide();
                document.getElementById('ourId').value = '';
            });

            /**
             * 处理编辑开发者ID
             */
            function handleEditOur(event) {
                const index = parseInt(event.target.dataset.index);
                const ours = whitelistData[OURS_INDEX] || [];
                const id = ours[index];

                document.getElementById('editOurId').value = id;
                document.getElementById('editOurIndex').value = index;
                const modal = new bootstrap.Modal(document.getElementById('editOurModal'));
                modal.show();
            }

            /**
             * 确认编辑开发者ID
             */
            document.getElementById('confirmEditOur').addEventListener('click', () => {
                const index = parseInt(document.getElementById('editOurIndex').value);
                const newId = document.getElementById('editOurId').value.trim();
                if (!newId) return;

                whitelistData[OURS_INDEX][index] = newId;
                renderOursTable();

                // 关闭模态框
                const modal = bootstrap.Modal.getInstance(document.getElementById('editOurModal'));
                modal.hide();
            });

            /**
             * 处理删除开发者ID
             */
            function handleDeleteOur(event) {
                const index = parseInt(event.target.dataset.index);
                if (confirm('确定要删除这个开发者ID吗？')) {
                    whitelistData[OURS_INDEX].splice(index, 1);
                    renderOursTable();
                }
            }

            /**
             * 确认编辑组
             */
            document.getElementById('confirmEditGroup').addEventListener('click', () => {
                const index = parseInt(document.getElementById('editGroupIndex').value);
                const newGroupName = document.getElementById('editGroupName').value.trim();
                if (!newGroupName) return;

                whitelistData[GROUPS_INDEX][index] = newGroupName;
                renderGroupsTable();

                // 关闭模态框
                const modal = bootstrap.Modal.getInstance(document.getElementById('editGroupModal'));
                modal.hide();
            });

            /**
             * 处理添加自爆程序标志
             */
            document.getElementById('confirmAddSs').addEventListener('click', () => {
                const ssValue = document.getElementById('ssValue').value.trim();
                if (!ssValue) return;

                whitelistData[SS_INDEX].push(ssValue);
                renderSsTable();

                // 关闭模态框并重置表单
                const modal = bootstrap.Modal.getInstance(document.getElementById('addSsModal'));
                modal.hide();
                document.getElementById('ssValue').value = '';
            });

            /**
             * 处理编辑自爆程序标志
             */
            function handleEditSs(event) {
                const index = parseInt(event.target.dataset.index);
                const ss = whitelistData[SS_INDEX] || [];
                const value = ss[index];

                document.getElementById('editSsValue').value = value;
                document.getElementById('editSsIndex').value = index;
                const modal = new bootstrap.Modal(document.getElementById('editSsModal'));
                modal.show();
            }

            /**
             * 确认编辑自爆程序标志
             */
            document.getElementById('confirmEditSs').addEventListener('click', () => {
                const index = parseInt(document.getElementById('editSsIndex').value);
                const newValue = document.getElementById('editSsValue').value.trim();
                if (!newValue) return;

                whitelistData[SS_INDEX][index] = newValue;
                renderSsTable();

                // 关闭模态框
                const modal = bootstrap.Modal.getInstance(document.getElementById('editSsModal'));
                modal.hide();
            });

            /**
             * 处理删除自爆程序标志
             */
            function handleDeleteSs(event) {
                const index = parseInt(event.target.dataset.index);
                if (confirm('确定要删除这个标志吗？')) {
                    whitelistData[SS_INDEX].splice(index, 1);
                    renderSsTable();
                }
            };

            /**
             * 处理删除组
             */
            function handleDeleteGroup(event) {
                const index = parseInt(event.target.dataset.index);
                if (confirm('确定要删除这个组吗？')) {
                    whitelistData[GROUPS_INDEX].splice(index, 1);
                    renderGroupsTable();
                }
            }

            /**
             * 处理添加身份验证Cookie
             */
            document.getElementById('confirmAddCookie1').addEventListener('click', () => {
                const cookie1Value = document.getElementById('cookie1Value').value.trim();
                if (!cookie1Value) return;

                whitelistData[COOKIE1_INDEX].push(cookie1Value);
                renderCookie1Table();

                // 关闭模态框并重置表单
                const modal = bootstrap.Modal.getInstance(document.getElementById('addCookie1Modal'));
                modal.hide();
                document.getElementById('cookie1Value').value = '';
            });

            /**
             * 处理编辑身份验证Cookie
             */
            function handleEditCookie1(event) {
                const index = parseInt(event.target.dataset.index);
                const cookie1 = whitelistData[COOKIE1_INDEX] || [];
                const value = cookie1[index];

                document.getElementById('editCookie1Value').value = value;
                document.getElementById('editCookie1Index').value = index;
                const modal = new bootstrap.Modal(document.getElementById('editCookie1Modal'));
                modal.show();
            }

            /**
             * 确认编辑身份验证Cookie
             */
            document.getElementById('confirmEditCookie1').addEventListener('click', () => {
                const index = parseInt(document.getElementById('editCookie1Index').value);
                const newValue = document.getElementById('editCookie1Value').value.trim();
                if (!newValue) return;

                whitelistData[COOKIE1_INDEX][index] = newValue;
                renderCookie1Table();

                // 关闭模态框
                const modal = bootstrap.Modal.getInstance(document.getElementById('editCookie1Modal'));
                modal.hide();
            });

            /**
             * 处理删除身份验证Cookie
             */
            function handleDeleteCookie1(event) {
                const index = parseInt(event.target.dataset.index);
                if (confirm('确定要删除这个Cookie值吗？')) {
                    whitelistData[COOKIE1_INDEX].splice(index, 1);
                    renderCookie1Table();
                }
            }

            /**
             * 处理添加用户
             */
            document.getElementById('confirmAddUser').addEventListener('click', () => {
                const userId = document.getElementById('userId').value.trim();
                const userName = document.getElementById('userName').value.trim();
                if (!userId || !userName) return;

                if (!whitelistData[USERS_INDEX]) {
                    whitelistData[USERS_INDEX] = [];
                }
                whitelistData[USERS_INDEX].push({
                    'id:': userId,
                    'name:': userName
                });
                renderUsersTable();

                // 关闭模态框并重置表单
                const modal = bootstrap.Modal.getInstance(document.getElementById('addUserModal'));
                modal.hide();
                document.getElementById('userId').value = '';
                document.getElementById('userName').value = '';
            });

            /**
             * 处理编辑用户
             */
            function handleEditUser(event) {
                const index = parseInt(event.target.dataset.index);
                const users = whitelistData[USERS_INDEX] || [];
                const user = users[index];

                document.getElementById('editUserId').value = user['id:'] || '';
                document.getElementById('editUserName').value = user['name:'] || '';
                document.getElementById('editUserIndex').value = index;
                const modal = new bootstrap.Modal(document.getElementById('editUserModal'));
                modal.show();
            }

            /**
             * 确认编辑用户
             */
            document.getElementById('confirmEditUser').addEventListener('click', () => {
                const index = parseInt(document.getElementById('editUserIndex').value);
                const newUserId = document.getElementById('editUserId').value.trim();
                const newUserName = document.getElementById('editUserName').value.trim();
                if (!newUserId || !newUserName) return;

                whitelistData[USERS_INDEX][index] = {
                    'id:': newUserId,
                    'name:': newUserName
                };
                renderUsersTable();

                // 关闭模态框
                const modal = bootstrap.Modal.getInstance(document.getElementById('editUserModal'));
                modal.hide();
            });

            /**
             * 处理删除用户
             */
            function handleDeleteUser(event) {
                const index = parseInt(event.target.dataset.index);
                if (confirm('确定要删除这个用户吗？')) {
                    whitelistData[USERS_INDEX].splice(index, 1);
                    renderUsersTable();
                }
            }

            /**
             * 保存GitHub Token到本地存储
             */
            document.getElementById('saveTokenBtn').addEventListener('click', async () => {
                const token = document.getElementById('githubToken').value.trim();
                if (token) {
                    localStorage.setItem('githubToken', token);
                    // 保存后检查权限
                    const hasPermission = await checkTokenPermission();
                    if (hasPermission) {
                        alert('Token已保存且验证通过');
                        // 显示主内容并初始化
                        document.querySelector('.container').style.display = 'block';
                        document.getElementById('permissionError').style.display = 'none';
                        document.getElementById('loginPrompt').style.display = 'none';
                        init();
                    } else {
                        alert('Token无效或无权限访问文件');
                        localStorage.removeItem('githubToken');
                        document.getElementById('githubToken').value = '';
                        showPermissionError();
                    }
                } else {
                    localStorage.removeItem('githubToken');
                    alert('Token已清除');
                    showLoginPrompt();
                }
            });

            // 页面加载时恢复保存的Token
            window.addEventListener('load', async () => {
                const savedToken = localStorage.getItem('githubToken');
                if (savedToken) {
                    document.getElementById('githubToken').value = savedToken;
                    // 检查权限
                    const hasPermission = await checkTokenPermission();
                    if (!hasPermission) {
                        showPermissionError();
                        return;
                    }
                    // 有权限，继续初始化
                    init();
                } else {
                    // 没有Token，显示登录模态窗口
                    showLoginPrompt();
                }
            });

            /**
             * 检查Token是否有权限编辑1.json
             */
            async function checkTokenPermission() {
                const token = localStorage.getItem('githubToken');
                if (!token) return false;

                const apiUrl = 'https://api.github.com/repos/Kosto179cn/Kosto.github.io/contents/js/1/1.json';
                
                try {
                    const response = await fetch(apiUrl, {
                        headers: {
                            'Authorization': `token ${encodeURIComponent(token)}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    return response.ok;
                } catch (error) {
                    console.error('权限检查失败:', error);
                    return false;
                }
            }

            /**
             * 显示权限不足错误
             */
            function showPermissionError() {
                document.querySelector('.container').style.display = 'none';
                document.getElementById('permissionError').style.display = 'block';
                document.getElementById('loginPrompt').style.display = 'none';
            }

            /**
             * 显示登录提示模态窗口
             */
            function showLoginPrompt() {
                // 清空Token输入框
                document.getElementById('githubTokenModal').value = '';
                document.getElementById('invalidTokenAlert').style.display = 'none';
                // 显示模态窗口
                const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                loginModal.show();
            }

            /**
             * 确认登录按钮点击事件
             */
            document.getElementById('confirmLoginBtn').addEventListener('click', async () => {
                const token = document.getElementById('githubTokenModal').value.trim();
                if (!token) {
                    document.getElementById('invalidTokenAlert').textContent = '请输入GitHub Token';
                    document.getElementById('invalidTokenAlert').style.display = 'block';
                    return;
                }

                // 保存Token并检查权限
                localStorage.setItem('githubToken', token);
                document.getElementById('githubToken').value = token;

                const hasPermission = await checkTokenPermission();
                if (hasPermission) {
                    // 权限验证通过，关闭模态窗口并初始化
                    const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                    loginModal.hide();
                    document.querySelector('.container').style.display = 'block';
                    document.getElementById('permissionError').style.display = 'none';
                    init();
                } else {
                    // 权限验证失败
                    document.getElementById('invalidTokenAlert').textContent = 'Token无效或无权限访问文件，请重新输入。';
                    document.getElementById('invalidTokenAlert').style.display = 'block';
                    localStorage.removeItem('githubToken');
                }
            });

            /**
             * 通过GitHub API更新文件
             */
            async function updateGitHubFile(content) {
                const token = localStorage.getItem('githubToken');
                if (!token) {
                    alert('请先设置GitHub Token');
                    return false;
                }

                const apiUrl = 'https://api.github.com/repos/Kosto179cn/Kosto.github.io/contents/js/1/1.json';
                const base64Content = btoa(unescape(encodeURIComponent(content)));

                try {
                    // 先获取文件信息以获取SHA
                    const infoResponse = await fetch(apiUrl, {
                        headers: {
                            'Authorization': `token ${encodeURIComponent(token)}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (!infoResponse.ok) throw new Error('获取文件信息失败');
                    const fileInfo = await infoResponse.json();

                    // 更新文件
                    const updateResponse = await fetch(apiUrl, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${encodeURIComponent(token)}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/vnd.github.v3+json'
                        },
                        body: JSON.stringify({
                            message: 'Update whitelist via manager',
                            content: base64Content,
                            sha: fileInfo.sha
                        })
                    });

                    if (!updateResponse.ok) throw new Error('更新文件失败');
                    return true;
                } catch (error) {
                    console.error('GitHub API错误:', error);
                    alert(`更新失败: ${error.message}`);
                    return false;
                }
            }

            /**
             * 保存更改
             */
            saveChangesBtn.addEventListener('click', async function() {
                try {
                    var data = JSON.stringify(whitelistData, null, 2);
                    const success = await updateGitHubFile(data);
                    if (success) {
                        alert('保存到GitHub成功，稍等半分钟/一分钟/两分钟即可');
                    }
                } catch (e) {
                    alert('保存失败: ' + e.message);
                }
            });

            // 初始化函数将在权限验证后调用
            // document.addEventListener('DOMContentLoaded', init);
        </script>
    </body>
    </html>