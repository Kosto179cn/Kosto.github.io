<!DOCTYPE html>
<html>
<head>
    <title>在线人数统计</title>
    <!-- 引入 Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <h1>当前在线人数：<span id="onlineCount">0</span></h1>

    <script>
        // 初始化 Firebase
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // 生成随机用户ID
        const userId = Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        const userRef = database.ref('onlineUsers/' + userId);

        // 设置用户在线状态
        userRef.set({
            timestamp: firebase.database.ServerValue.TIMESTAMP
        }).then(() => {
            // 确保断开连接时删除节点
            userRef.onDisconnect().remove();
        });

        // 实时监听在线人数
        database.ref('onlineUsers').on('value', (snapshot) => {
            const onlineUsers = snapshot.val() || {};
            const count = Object.keys(onlineUsers).length;
            document.getElementById('onlineCount').textContent = count;
        });
    </script>
</body>
</html>
